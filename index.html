<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Product Viewer</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <style>
        /* 2. MODERN STYLING (CSS) */
        body { margin: 0; font-family: 'Helvetica Neue', sans-serif; background-color: #f4f4f4; color: #333; }
        
        /* Menu Screen Styles */
        #menu-container { padding: 20px; max-width: 600px; margin: 0 auto; display: none; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 24px; font-weight: 700; }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .card { background: white; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .card h3 { margin: 10px 0 5px; font-size: 16px; }
        .card p { color: #666; font-size: 14px; margin: 0; }
        .emoji-placeholder { font-size: 40px; display: block; margin-bottom: 10px; }

        /* AR Viewer Styles */
        #ar-container { width: 100vw; height: 100vh; display: none; background: #fff; position: relative; }
        model-viewer { width: 100%; height: 100%; }
        
        .back-btn { position: absolute; top: 20px; left: 20px; z-index: 100; background: rgba(255,255,255,0.8); border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; backdrop-filter: blur(5px); }
        
        /* Custom AR Button */
        .ar-button { background-color: #000; color: white; border-radius: 4px; border: none; position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); padding: 12px 24px; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

    <div id="menu-container">
        <div class="header">
            <h1>Virtual Catalog</h1>
            <p>Select a product to view in AR</p>
        </div>
        <div class="product-grid" id="grid-target">
            </div>
    </div>

    <div id="ar-container">
        <button class="back-btn" onclick="goHome()">‚Üê Back</button>
        
        <model-viewer 
            id="viewer"
            src="" 
            ios-src=""
            poster="" 
            alt="A 3D model"
            shadow-intensity="1"
            camera-controls
            auto-rotate
            ar>
            
            <button slot="ar-button" class="ar-button">
                View in your space üëã
            </button>
        </model-viewer>
    </div>

    <script>
        // 3. THE DATABASE (Edit this list to add your products!)
        const products = [
            {
                id: "flowerpot",
                name: "flowerpot",
                // NOTE: This uses a sample Google model. Replace with your filename (e.g., 'latte.glb')
                modelFile: "./flower.glb", 
                price: "Millions of PKR",
                emoji: "üë®‚ÄçüöÄ"
            },
            {
                id: "chair",
                name: "Modern Chair",
                // NOTE: Replace with your own file later
                modelFile: "https://modelviewer.dev/shared-assets/models/Chair.glb",
                price: "$150.00",
                emoji: "ü™ë"
            }
        ];

        // 4. THE LOGIC (Don't touch this unless you know JS)
        const params = new URLSearchParams(window.location.search);
        const productId = params.get('product'); // Checks URL for ?product=...
        const menuEl = document.getElementById('menu-container');
        const arEl = document.getElementById('ar-container');
        const gridEl = document.getElementById('grid-target');
        const viewerEl = document.getElementById('viewer');

        if (productId) {
            // MODE A: Direct Product Link (Hidden Menu, Show AR)
            const product = products.find(p => p.id === productId);
            
            if (product) {
                showAR(product);
            } else {
                alert("Product not found! Redirecting to menu.");
                window.location.href = window.location.pathname;
            }
        } else {
            // MODE B: Main Menu (Show Grid)
            menuEl.style.display = 'block';
            
            // Generate the grid items
            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <span class="emoji-placeholder">${p.emoji}</span>
                    <h3>${p.name}</h3>
                    <p>${p.price}</p>
                `;
                card.onclick = () => {
                    // Update URL without reloading page (Modern SPA feel)
                    const newUrl = `${window.location.pathname}?product=${p.id}`;
                    window.history.pushState({path: newUrl}, '', newUrl);
                    showAR(p);
                };
                gridEl.appendChild(card);
            });
        }

        function showAR(product) {
            menuEl.style.display = 'none';
            arEl.style.display = 'block';
            
            // Load the specific model into the viewer
            viewerEl.src = product.modelFile;
            // iOS requires a .usdz file for AR, but ModelViewer can auto-generate it often.
            // Ideally, for iOS, you just rely on the .glb which works in 'scene-viewer' mode on Android.
        }

        function goHome() {
            // Clear URL param and reload to show menu
            window.location.href = window.location.pathname; 
        }
    </script>
</body>

</html>

